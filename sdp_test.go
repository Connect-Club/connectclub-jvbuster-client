package jvbuster

import (
	"encoding/base64"
	"testing"
)

func Test_mungeSdpForSimulcasting(t *testing.T) {
	b64Sdp := "dj0wDQpvPS0gNDk5NDY2MDE3NTAwMjMxNDIyOSAyIElOIElQNCAxMjcuMC4wLjENCnM9LQ0KdD0wIDANCmE9Z3JvdXA6QlVORExFIGRhdGEtZGNmZTAxZGY0ZjNkN2E4MC0yNzM2ZjA0MTJlODNjMzhmIGF1ZGlvLW1peGVkLWFjYzcyM2E1NmYwYjllM2MgdmlkZW8tbWl4ZWQtNDcwYzhhODFmMWVkMDYyZSB2aWRlby1zY3JlZW4tMTg1MC0zOTk2YmNkYzIzOGQ3ZTZjDQphPW1zaWQtc2VtYW50aWM6IFdNUyBORWNKaTdtR1VDT0ljUGw2YzdsSklNSUkwdVZJakVySVlsY3MNCm09YXBwbGljYXRpb24gOSBEVExTL1NDVFAgNTAwMA0KYz1JTiBJUDQgMC4wLjAuMA0KYT1pY2UtdWZyYWc6UTQrRw0KYT1pY2UtcHdkOmxkY01YWjNIdE15VGtVTUJlVkdhdURNLw0KYT1pY2Utb3B0aW9uczp0cmlja2xlDQphPWZpbmdlcnByaW50OnNoYS0yNTYgQjI6Mjk6QjU6NTQ6NEM6RjU6NjA6MEE6NEI6MTY6MTU6M0Q6NDI6Nzc6MTE6N0E6MkQ6NjQ6REI6MUE6MTA6QUY6NkM6MjU6NUM6QkI6OUY6RjM6Q0Y6RjY6NzY6MzENCmE9c2V0dXA6YWN0aXZlDQphPW1pZDpkYXRhLWRjZmUwMWRmNGYzZDdhODAtMjczNmYwNDEyZTgzYzM4Zg0KYT1zY3RwbWFwOjUwMDAgd2VicnRjLWRhdGFjaGFubmVsIDEwMjQNCm09YXVkaW8gOSBSVFAvU0FWUEYgMTExDQpjPUlOIElQNCAwLjAuMC4wDQphPXJ0Y3A6OSBJTiBJUDQgMC4wLjAuMA0KYT1pY2UtdWZyYWc6UTQrRw0KYT1pY2UtcHdkOmxkY01YWjNIdE15VGtVTUJlVkdhdURNLw0KYT1pY2Utb3B0aW9uczp0cmlja2xlDQphPWZpbmdlcnByaW50OnNoYS0yNTYgQjI6Mjk6QjU6NTQ6NEM6RjU6NjA6MEE6NEI6MTY6MTU6M0Q6NDI6Nzc6MTE6N0E6MkQ6NjQ6REI6MUE6MTA6QUY6NkM6MjU6NUM6QkI6OUY6RjM6Q0Y6RjY6NzY6MzENCmE9c2V0dXA6YWN0aXZlDQphPW1pZDphdWRpby1taXhlZC1hY2M3MjNhNTZmMGI5ZTNjDQphPWV4dG1hcDoxIHVybjppZXRmOnBhcmFtczpydHAtaGRyZXh0OnNzcmMtYXVkaW8tbGV2ZWwNCmE9ZXh0bWFwOjUgaHR0cDovL3d3dy5pZXRmLm9yZy9pZC9kcmFmdC1ob2xtZXItcm1jYXQtdHJhbnNwb3J0LXdpZGUtY2MtZXh0ZW5zaW9ucy0wMQ0KYT1zZW5kcmVjdg0KYT1tc2lkOk5FY0ppN21HVUNPSWNQbDZjN2xKSU1JSTB1VklqRXJJWWxjcyBiNTM2ODhhZi0wYWFlLTQwZWQtYWQwNy0yMTU4OWNjYzUyMzgNCmE9cnRjcC1tdXgNCmE9cnRwbWFwOjExMSBvcHVzLzQ4MDAwLzINCmE9cnRjcC1mYjoxMTEgdHJhbnNwb3J0LWNjDQphPWZtdHA6MTExIG1pbnB0aW1lPTEwO3VzZWluYmFuZGZlYz0xDQphPXNzcmM6MjIzMjg0ODUyMCBjbmFtZTpRZGNJL3pITWdtRkVFRlMrDQptPXZpZGVvIDkgUlRQL1NBVlBGIDEwMCA5Ng0KYz1JTiBJUDQgMC4wLjAuMA0KYT1ydGNwOjkgSU4gSVA0IDAuMC4wLjANCmE9aWNlLXVmcmFnOlE0K0cNCmE9aWNlLXB3ZDpsZGNNWFozSHRNeVRrVU1CZVZHYXVETS8NCmE9aWNlLW9wdGlvbnM6dHJpY2tsZQ0KYT1maW5nZXJwcmludDpzaGEtMjU2IEIyOjI5OkI1OjU0OjRDOkY1OjYwOjBBOjRCOjE2OjE1OjNEOjQyOjc3OjExOjdBOjJEOjY0OkRCOjFBOjEwOkFGOjZDOjI1OjVDOkJCOjlGOkYzOkNGOkY2Ojc2OjMxDQphPXNldHVwOmFjdGl2ZQ0KYT1taWQ6dmlkZW8tbWl4ZWQtNDcwYzhhODFmMWVkMDYyZQ0KYT1leHRtYXA6MyBodHRwOi8vd3d3LndlYnJ0Yy5vcmcvZXhwZXJpbWVudHMvcnRwLWhkcmV4dC9hYnMtc2VuZC10aW1lDQphPWV4dG1hcDo1IGh0dHA6Ly93d3cuaWV0Zi5vcmcvaWQvZHJhZnQtaG9sbWVyLXJtY2F0LXRyYW5zcG9ydC13aWRlLWNjLWV4dGVuc2lvbnMtMDENCmE9c2VuZHJlY3YNCmE9bXNpZDpORWNKaTdtR1VDT0ljUGw2YzdsSklNSUkwdVZJakVySVlsY3MgYTEzMTc3NWItMDYxNS00ZmMzLWJjZTktNWVhNWIzNzVmZmI4DQphPXJ0Y3AtbXV4DQphPXJ0cG1hcDoxMDAgVlA4LzkwMDAwDQphPXJ0Y3AtZmI6MTAwIHRyYW5zcG9ydC1jYw0KYT1ydGNwLWZiOjEwMCBjY20gZmlyDQphPXJ0Y3AtZmI6MTAwIG5hY2sNCmE9cnRjcC1mYjoxMDAgbmFjayBwbGkNCmE9cnRwbWFwOjk2IHJ0eC85MDAwMA0KYT1mbXRwOjk2IGFwdD0xMDANCmE9c3NyYy1ncm91cDpGSUQgMzMyOTY3MTcwIDE2MjA2NTExMQ0KYT1zc3JjOjMzMjk2NzE3MCBjbmFtZTpRZGNJL3pITWdtRkVFRlMrDQphPXNzcmM6MTYyMDY1MTExIGNuYW1lOlFkY0kvekhNZ21GRUVGUysNCm09dmlkZW8gOSBSVFAvU0FWUEYgMTAwIDk2DQpjPUlOIElQNCAwLjAuMC4wDQphPXJ0Y3A6OSBJTiBJUDQgMC4wLjAuMA0KYT1pY2UtdWZyYWc6UTQrRw0KYT1pY2UtcHdkOmxkY01YWjNIdE15VGtVTUJlVkdhdURNLw0KYT1pY2Utb3B0aW9uczp0cmlja2xlDQphPWZpbmdlcnByaW50OnNoYS0yNTYgQjI6Mjk6QjU6NTQ6NEM6RjU6NjA6MEE6NEI6MTY6MTU6M0Q6NDI6Nzc6MTE6N0E6MkQ6NjQ6REI6MUE6MTA6QUY6NkM6MjU6NUM6QkI6OUY6RjM6Q0Y6RjY6NzY6MzENCmE9c2V0dXA6YWN0aXZlDQphPW1pZDp2aWRlby1zY3JlZW4tMTg1MC0zOTk2YmNkYzIzOGQ3ZTZjDQphPWV4dG1hcDozIGh0dHA6Ly93d3cud2VicnRjLm9yZy9leHBlcmltZW50cy9ydHAtaGRyZXh0L2Ficy1zZW5kLXRpbWUNCmE9ZXh0bWFwOjUgaHR0cDovL3d3dy5pZXRmLm9yZy9pZC9kcmFmdC1ob2xtZXItcm1jYXQtdHJhbnNwb3J0LXdpZGUtY2MtZXh0ZW5zaW9ucy0wMQ0KYT1yZWN2b25seQ0KYT1ydGNwLW11eA0KYT1ydHBtYXA6MTAwIFZQOC85MDAwMA0KYT1ydGNwLWZiOjEwMCB0cmFuc3BvcnQtY2MNCmE9cnRjcC1mYjoxMDAgY2NtIGZpcg0KYT1ydGNwLWZiOjEwMCBuYWNrDQphPXJ0Y3AtZmI6MTAwIG5hY2sgcGxpDQphPXJ0cG1hcDo5NiBydHgvOTAwMDANCmE9Zm10cDo5NiBhcHQ9MTAwDQo="
	//b64Sdp := "dj0wDQpvPS0gMjI0ODY0NzA1NjM3NDA5MjI4IDIgSU4gSVA0IDEyNy4wLjAuMQ0Kcz0tDQp0PTAgMA0KYT1ncm91cDpCVU5ETEUgZGF0YS1hOGQyMmI3MjZlMDUzZjdkLTVlYmIzMTk3NjMxMmE4YWYgYXVkaW8tbWl4ZWQtNTY2YTNjYWU5MTMzNWE5MyB2aWRlby1taXhlZC00ODUzZGIwM2Y3NGQ1MTI2DQphPW1zaWQtc2VtYW50aWM6IFdNUyBXajNCdldpS1JuVW9GeVVSUzBlQURVdDVqdG9jOTBIY0g0cGcNCm09YXBwbGljYXRpb24gOSBEVExTL1NDVFAgNTAwMA0KYz1JTiBJUDQgMC4wLjAuMA0KYT1pY2UtdWZyYWc6bHJPVw0KYT1pY2UtcHdkOmtmQXR4YXpiNmh1QmZzMlVldFc1cHJseg0KYT1pY2Utb3B0aW9uczp0cmlja2xlDQphPWZpbmdlcnByaW50OnNoYS0yNTYgODc6Q0E6RkQ6MkI6Rjk6MTE6M0Q6QkM6NjA6NjU6NUM6NDQ6NkY6QzU6REE6MkI6MTA6Q0Q6RjQ6NUQ6REI6QzQ6RTE6MDk6NTE6REU6NTA6ODk6MjI6OTk6ODc6REYNCmE9c2V0dXA6YWN0aXZlDQphPW1pZDpkYXRhLWE4ZDIyYjcyNmUwNTNmN2QtNWViYjMxOTc2MzEyYThhZg0KYT1zY3RwbWFwOjUwMDAgd2VicnRjLWRhdGFjaGFubmVsIDEwMjQNCm09YXVkaW8gOSBSVFAvU0FWUEYgMTExDQpjPUlOIElQNCAwLjAuMC4wDQphPXJ0Y3A6OSBJTiBJUDQgMC4wLjAuMA0KYT1pY2UtdWZyYWc6bHJPVw0KYT1pY2UtcHdkOmtmQXR4YXpiNmh1QmZzMlVldFc1cHJseg0KYT1pY2Utb3B0aW9uczp0cmlja2xlDQphPWZpbmdlcnByaW50OnNoYS0yNTYgODc6Q0E6RkQ6MkI6Rjk6MTE6M0Q6QkM6NjA6NjU6NUM6NDQ6NkY6QzU6REE6MkI6MTA6Q0Q6RjQ6NUQ6REI6QzQ6RTE6MDk6NTE6REU6NTA6ODk6MjI6OTk6ODc6REYNCmE9c2V0dXA6YWN0aXZlDQphPW1pZDphdWRpby1taXhlZC01NjZhM2NhZTkxMzM1YTkzDQphPWV4dG1hcDoxIHVybjppZXRmOnBhcmFtczpydHAtaGRyZXh0OnNzcmMtYXVkaW8tbGV2ZWwNCmE9ZXh0bWFwOjUgaHR0cDovL3d3dy5pZXRmLm9yZy9pZC9kcmFmdC1ob2xtZXItcm1jYXQtdHJhbnNwb3J0LXdpZGUtY2MtZXh0ZW5zaW9ucy0wMQ0KYT1zZW5kcmVjdg0KYT1tc2lkOldqM0J2V2lLUm5Vb0Z5VVJTMGVBRFV0NWp0b2M5MEhjSDRwZyA3NWMyNzJkMi0xZjg3LTRjZWQtOTA3My02NmRmNjAxNTZhODgNCmE9cnRjcC1tdXgNCmE9cnRwbWFwOjExMSBvcHVzLzQ4MDAwLzINCmE9cnRjcC1mYjoxMTEgdHJhbnNwb3J0LWNjDQphPWZtdHA6MTExIG1pbnB0aW1lPTEwO3VzZWluYmFuZGZlYz0xDQphPXNzcmM6MTY2MDExODY4OSBjbmFtZTpOSG5adHJLZ0VNaUcvWFpzDQptPXZpZGVvIDkgUlRQL1NBVlBGIDEwMCA5Ng0KYz1JTiBJUDQgMC4wLjAuMA0KYT1ydGNwOjkgSU4gSVA0IDAuMC4wLjANCmE9aWNlLXVmcmFnOmxyT1cNCmE9aWNlLXB3ZDprZkF0eGF6YjZodUJmczJVZXRXNXBybHoNCmE9aWNlLW9wdGlvbnM6dHJpY2tsZQ0KYT1maW5nZXJwcmludDpzaGEtMjU2IDg3OkNBOkZEOjJCOkY5OjExOjNEOkJDOjYwOjY1OjVDOjQ0OjZGOkM1OkRBOjJCOjEwOkNEOkY0OjVEOkRCOkM0OkUxOjA5OjUxOkRFOjUwOjg5OjIyOjk5Ojg3OkRGDQphPXNldHVwOmFjdGl2ZQ0KYT1taWQ6dmlkZW8tbWl4ZWQtNDg1M2RiMDNmNzRkNTEyNg0KYT1leHRtYXA6MyBodHRwOi8vd3d3LndlYnJ0Yy5vcmcvZXhwZXJpbWVudHMvcnRwLWhkcmV4dC9hYnMtc2VuZC10aW1lDQphPWV4dG1hcDo1IGh0dHA6Ly93d3cuaWV0Zi5vcmcvaWQvZHJhZnQtaG9sbWVyLXJtY2F0LXRyYW5zcG9ydC13aWRlLWNjLWV4dGVuc2lvbnMtMDENCmE9c2VuZHJlY3YNCmE9bXNpZDpXajNCdldpS1JuVW9GeVVSUzBlQURVdDVqdG9jOTBIY0g0cGcgZmU1NTRjZjgtNTFkNi00YWJiLTk2NDItZjBhNDcxYmJlMDJlDQphPXJ0Y3AtbXV4DQphPXJ0cG1hcDoxMDAgVlA4LzkwMDAwDQphPXJ0Y3AtZmI6MTAwIHRyYW5zcG9ydC1jYw0KYT1ydGNwLWZiOjEwMCBjY20gZmlyDQphPXJ0Y3AtZmI6MTAwIG5hY2sNCmE9cnRjcC1mYjoxMDAgbmFjayBwbGkNCmE9cnRwbWFwOjk2IHJ0eC85MDAwMA0KYT1mbXRwOjk2IGFwdD0xMDANCmE9c3NyYy1ncm91cDpGSUQgMTM5ODQ4NTQwNyAxNDY4OTc0Mzg5DQphPXNzcmM6MTM5ODQ4NTQwNyBjbmFtZTpOSG5adHJLZ0VNaUcvWFpzDQphPXNzcmM6MTQ2ODk3NDM4OSBjbmFtZTpOSG5adHJLZ0VNaUcvWFpzDQo="
	sdp, err := base64.StdEncoding.DecodeString(b64Sdp)
	if err != nil {
		panic(err)
	}
	mungedSdp:=mungeSdpForSimulcasting(string(sdp), TwoSimulcastLayers)
	b64SdpExpected := "dj0wDQpvPS0gMjI0ODY0NzA1NjM3NDA5MjI4IDIgSU4gSVA0IDEyNy4wLjAuMQ0Kcz0tDQp0PTAgMA0KYT1ncm91cDpCVU5ETEUgZGF0YS1hOGQyMmI3MjZlMDUzZjdkLTVlYmIzMTk3NjMxMmE4YWYgYXVkaW8tbWl4ZWQtNTY2YTNjYWU5MTMzNWE5MyB2aWRlby1taXhlZC00ODUzZGIwM2Y3NGQ1MTI2DQphPW1zaWQtc2VtYW50aWM6IFdNUyBXajNCdldpS1JuVW9GeVVSUzBlQURVdDVqdG9jOTBIY0g0cGcNCm09YXBwbGljYXRpb24gOSBEVExTL1NDVFAgNTAwMA0KYz1JTiBJUDQgMC4wLjAuMA0KYT1pY2UtdWZyYWc6bHJPVw0KYT1pY2UtcHdkOmtmQXR4YXpiNmh1QmZzMlVldFc1cHJseg0KYT1pY2Utb3B0aW9uczp0cmlja2xlDQphPWZpbmdlcnByaW50OnNoYS0yNTYgODc6Q0E6RkQ6MkI6Rjk6MTE6M0Q6QkM6NjA6NjU6NUM6NDQ6NkY6QzU6REE6MkI6MTA6Q0Q6RjQ6NUQ6REI6QzQ6RTE6MDk6NTE6REU6NTA6ODk6MjI6OTk6ODc6REYNCmE9c2V0dXA6YWN0aXZlDQphPW1pZDpkYXRhLWE4ZDIyYjcyNmUwNTNmN2QtNWViYjMxOTc2MzEyYThhZg0KYT1zY3RwbWFwOjUwMDAgd2VicnRjLWRhdGFjaGFubmVsIDEwMjQNCm09YXVkaW8gOSBSVFAvU0FWUEYgMTExDQpjPUlOIElQNCAwLjAuMC4wDQphPXJ0Y3A6OSBJTiBJUDQgMC4wLjAuMA0KYT1pY2UtdWZyYWc6bHJPVw0KYT1pY2UtcHdkOmtmQXR4YXpiNmh1QmZzMlVldFc1cHJseg0KYT1pY2Utb3B0aW9uczp0cmlja2xlDQphPWZpbmdlcnByaW50OnNoYS0yNTYgODc6Q0E6RkQ6MkI6Rjk6MTE6M0Q6QkM6NjA6NjU6NUM6NDQ6NkY6QzU6REE6MkI6MTA6Q0Q6RjQ6NUQ6REI6QzQ6RTE6MDk6NTE6REU6NTA6ODk6MjI6OTk6ODc6REYNCmE9c2V0dXA6YWN0aXZlDQphPW1pZDphdWRpby1taXhlZC01NjZhM2NhZTkxMzM1YTkzDQphPWV4dG1hcDoxIHVybjppZXRmOnBhcmFtczpydHAtaGRyZXh0OnNzcmMtYXVkaW8tbGV2ZWwNCmE9ZXh0bWFwOjUgaHR0cDovL3d3dy5pZXRmLm9yZy9pZC9kcmFmdC1ob2xtZXItcm1jYXQtdHJhbnNwb3J0LXdpZGUtY2MtZXh0ZW5zaW9ucy0wMQ0KYT1zZW5kcmVjdg0KYT1tc2lkOldqM0J2V2lLUm5Vb0Z5VVJTMGVBRFV0NWp0b2M5MEhjSDRwZyA3NWMyNzJkMi0xZjg3LTRjZWQtOTA3My02NmRmNjAxNTZhODgNCmE9cnRjcC1tdXgNCmE9cnRwbWFwOjExMSBvcHVzLzQ4MDAwLzINCmE9cnRjcC1mYjoxMTEgdHJhbnNwb3J0LWNjDQphPWZtdHA6MTExIG1pbnB0aW1lPTEwO3VzZWluYmFuZGZlYz0xDQphPXNzcmM6MTY2MDExODY4OSBjbmFtZTpOSG5adHJLZ0VNaUcvWFpzDQptPXZpZGVvIDkgUlRQL1NBVlBGIDEwMCA5Ng0KYz1JTiBJUDQgMC4wLjAuMA0KYT1ydGNwOjkgSU4gSVA0IDAuMC4wLjANCmE9aWNlLXVmcmFnOmxyT1cNCmE9aWNlLXB3ZDprZkF0eGF6YjZodUJmczJVZXRXNXBybHoNCmE9aWNlLW9wdGlvbnM6dHJpY2tsZQ0KYT1maW5nZXJwcmludDpzaGEtMjU2IDg3OkNBOkZEOjJCOkY5OjExOjNEOkJDOjYwOjY1OjVDOjQ0OjZGOkM1OkRBOjJCOjEwOkNEOkY0OjVEOkRCOkM0OkUxOjA5OjUxOkRFOjUwOjg5OjIyOjk5Ojg3OkRGDQphPXNldHVwOmFjdGl2ZQ0KYT1taWQ6dmlkZW8tbWl4ZWQtNDg1M2RiMDNmNzRkNTEyNg0KYT1leHRtYXA6MyBodHRwOi8vd3d3LndlYnJ0Yy5vcmcvZXhwZXJpbWVudHMvcnRwLWhkcmV4dC9hYnMtc2VuZC10aW1lDQphPWV4dG1hcDo1IGh0dHA6Ly93d3cuaWV0Zi5vcmcvaWQvZHJhZnQtaG9sbWVyLXJtY2F0LXRyYW5zcG9ydC13aWRlLWNjLWV4dGVuc2lvbnMtMDENCmE9c2VuZHJlY3YNCmE9bXNpZDpXajNCdldpS1JuVW9GeVVSUzBlQURVdDVqdG9jOTBIY0g0cGcgZmU1NTRjZjgtNTFkNi00YWJiLTk2NDItZjBhNDcxYmJlMDJlDQphPXJ0Y3AtbXV4DQphPXJ0cG1hcDoxMDAgVlA4LzkwMDAwDQphPXJ0Y3AtZmI6MTAwIHRyYW5zcG9ydC1jYw0KYT1ydGNwLWZiOjEwMCBjY20gZmlyDQphPXJ0Y3AtZmI6MTAwIG5hY2sNCmE9cnRjcC1mYjoxMDAgbmFjayBwbGkNCmE9cnRwbWFwOjk2IHJ0eC85MDAwMA0KYT1mbXRwOjk2IGFwdD0xMDANCmE9c3NyYzoxMzk4NDg1NDA3IGNuYW1lOk5Iblp0cktnRU1pRy9YWnMNCmE9c3NyYzoxNDY4OTc0Mzg5IGNuYW1lOk5Iblp0cktnRU1pRy9YWnMNCmE9c3NyYzoyNjg1Mjc4ODE4IGNuYW1lOk5Iblp0cktnRU1pRy9YWnMNCmE9c3NyYzoyNjM2MDA1NjIxIGNuYW1lOk5Iblp0cktnRU1pRy9YWnMNCmE9c3NyYy1ncm91cDpTSU0gMTM5ODQ4NTQwNyAyNjg1Mjc4ODE4DQphPXNzcmMtZ3JvdXA6RklEIDI2ODUyNzg4MTggMjYzNjAwNTYyMQ0KYT1zc3JjLWdyb3VwOkZJRCAxMzk4NDg1NDA3IDE0Njg5NzQzODkNCg=="
	if base64.StdEncoding.EncodeToString([]byte(mungedSdp)) != b64SdpExpected {
		t.Fatal("sdp is not match")
	}
}
